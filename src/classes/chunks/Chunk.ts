//
// Imports
//

import { Pure3DBinaryWriter } from "../Pure3DBinaryWriter.js";

//
// Class
//

export interface ChunkParseDataOptions
{
	arrayBuffer : ArrayBuffer;

	isLittleEndian : boolean;
}

export interface ChunkOptions
{
	identifier : number;

	children? : Chunk[];
}

export class Chunk
{
	static identifiers =
		{
			ANIM: 0x3F0000C,
			ANIMATED_OBJECT: 0x20001,
			ANIMATED_OBJECT_ANIMATION: 0x20002,
			ANIMATED_OBJECT_FACTORY: 0x20000,
			ANIMATION: 0x121000,
			ANIMATION_CHANNEL_COUNT: 0x121007,
			ANIMATION_GROUP: 0x121001,
			ANIMATION_GROUP_LIST: 0x121002,
			ANIMATION_HEADER: 0x121006,
			ANIMATION_SIZE: 0x121004,
			ANIM_COLL: 0x3F00008,
			ANIM_DYNA_PHYS: 0x3F0000E,
			ANIM_DYNA_PHYS_WRAPPER: 0x3F0000F,
			ANIM_OBJ_WRAPPER: 0x3F00010,
			ATC: 0x3000602,
			BOOLEAN_CHANNEL: 0x121108,
			BOUNDING_BOX: 0x10003,
			BOUNDING_SPHERE: 0x10004,
			BREAKABLE_OBJECT: 0x3001000,
			CAMERA: 0x2200,
			CHANNEL_INTERPOLATION_MODE: 0x121110,
			COLLISION_AXIS_ALIGNED_BOUNDING_BOX: 0x7010006,
			COLLISION_CYLINDER: 0x7010003,
			COLLISION_EFFECT: 0x3000600,
			COLLISION_OBJECT: 0x7010000,
			COLLISION_OBJECT_ATTRIBUTE: 0x7010023,
			COLLISION_ORIENTED_BOUNDING_BOX: 0x7010004,
			COLLISION_SPHERE: 0x7010002,
			COLLISION_VECTOR: 0x7010007,
			COLLISION_VOLUME: 0x7010001,
			COLLISION_VOLUME_OWNER: 0x7010021,
			COLLISION_VOLUME_OWNER_NAME: 0x7010022,
			COLLISION_WALL: 0x7010005,
			COLOUR_CHANNEL: 0x121109,
			COLOUR_LIST: 0x10008,
			COMPOSITE_DRAWABLE: 0x4512,
			COMPOSITE_DRAWABLE_EFFECT: 0x4518,
			COMPOSITE_DRAWABLE_EFFECT_LIST: 0x4517,
			COMPOSITE_DRAWABLE_PROP: 0x4516,
			COMPOSITE_DRAWABLE_PROP_LIST: 0x4514,
			COMPOSITE_DRAWABLE_SKIN: 0x4515,
			COMPOSITE_DRAWABLE_SKIN_LIST: 0x4513,
			COMPOSITE_DRAWABLE_SORT_ORDER: 0x4519,
			COMPRESSED_QUATERNION_CHANNEL: 0x121111,
			DYNA_PHYS: 0x3F00002,
			ENTITY_CHANNEL: 0x121107,
			EXPORT_INFO: 0x7030,
			EXPORT_INFO_NAMED_INTEGER: 0x7032,
			EXPORT_INFO_NAMED_STRING: 0x7031,
			EXPRESSION: 0x21000,
			EXPRESSION_GROUP: 0x21001,
			EXPRESSION_MIXER: 0x21002,
			FENCE: 0x3F00007,
			FENCE_2: 0x3000000,
			FLOAT_1_CHANNEL: 0x121100,
			FLOAT_2_CHANNEL: 0x121101,
			FOLLOW_CAMERA_DATA: 0x3000100,
			FRAME_CONTROLLER: 0x121201,
			FRONTEND_GROUP: 0x18004,
			FRONTEND_IMAGE_RESOURCE: 0x18100,
			FRONTEND_LANGUAGE: 0x1800E,
			FRONTEND_LAYER: 0x18003,
			FRONTEND_MULTI_SPRITE: 0x18006,
			FRONTEND_MULTI_TEXT: 0x18007,
			FRONTEND_PAGE: 0x18002,
			FRONTEND_POLYGON: 0x18009,
			FRONTEND_PROJECT: 0x18000,
			FRONTEND_PURE3D_OBJECT: 0x18008,
			FRONTEND_PURE3D_RESOURCE: 0x18101,
			FRONTEND_SCREEN: 0x18001,
			FRONTEND_STRING_HARD_CODED: 0x1800C,
			FRONTEND_STRING_TEXT_BIBLE: 0x1800B,
			FRONTEND_TEXT_BIBLE: 0x1800D,
			FRONTEND_TEXT_BIBLE_RESOURCE: 0x18105,
			FRONTEND_TEXT_STYLE_RESOURCE: 0x18104,
			GAME_ATTR: 0x12000,
			GAME_ATTRIBUTE_INTEGER_PARAMETER: 0x12001,
			GAME_ATTRIBUTE_FLOAT_PARAMETER: 0x12002,
			GAME_ATTRIBUTE_COLOUR_PARAMETER: 0x12003,
			GAME_ATTRIBUTE_VECTOR_PARAMETER: 0x12004,
			GAME_ATTRIBUTE_MATRIX_PARAMETER: 0x12005,
			HISTORY: 0x7000,
			IMAGE: 0x19001,
			IMAGE_DATA: 0x19002,
			INDEX_LIST: 0x1000A,
			INSTANCE_LIST: 0x3000008,
			INST_PARTICLE_SYSTEM: 0x3001001,
			INST_STAT_ENTITY: 0x3F00009,
			INST_STAT_PHYS: 0x3F0000A,
			INTEGER_CHANNEL: 0x12110E,
			INTERSECT: 0x3F00003,
			INTERSECTION: 0x3000004,
			INTERSECT_MESH: 0x1008,
			INTERSECT_MESH_2: 0x1009,
			LENS_FLARE: 0x3F0000D,
			LIGHT: 0x13000,
			LIGHT_DIRECTION: 0x13001,
			LIGHT_GROUP: 0x2380,
			LIGHT_ILLUMINATION_TYPE: 0x13008,
			LIGHT_POSITION: 0x13002,
			LIGHT_SHADOW: 0x13004,
			LOCATOR: 0x3000005,
			LOCATOR_3: 0x14000,
			LOCATOR_MATRIX: 0x300000C,
			MATRIX_LIST: 0x1000B,
			MATRIX_PALETTE: 0x1000D,
			MESH: 0x10000,
			MULTI_CONTROLLER: 0x48A0,
			MULTI_CONTROLLER_2: 0x121202,
			MULTI_CONTROLLER_TRACK: 0x121203,
			MULTI_CONTROLLER_TRACKS: 0x48A1,
			NORMAL_LIST: 0x10006,
			OLD_BASE_EMITTER: 0x15805,
			OLD_BILLBOARD_DISPLAY_INFO: 0x17003,
			OLD_BILLBOARD_PERSPECTIVE_INFO: 0x17004,
			OLD_BILLBOARD_QUAD: 0x17001,
			OLD_BILLBOARD_QUAD_GROUP: 0x17002,
			OLD_COLOUR_OFFSET_LIST: 0x121300,
			OLD_EMITTER_ANIMATION: 0x15809,
			OLD_EXPRESSION_OFFSETS: 0x10018,
			OLD_FRAME_CONTROLLER: 0x121200,
			OLD_GENERATOR_ANIMATION: 0x1580A,
			OLD_INDEX_OFFSET_LIST: 0x121303,
			OLD_OFFSET_LIST: 0x1000E,
			OLD_PARTICLE_ANIMATION: 0x15808,
			OLD_PARTICLE_INSTANCING_INFO: 0x1580B,
			OLD_PRIMITIVE_GROUP: 0x10002,
			OLD_SCENEGRAPH_BRANCH: 0x120102,
			OLD_SCENEGRAPH_DRAWABLE: 0x120107,
			OLD_SCENEGRAPH_LIGHT_GROUP: 0x120109,
			OLD_SCENEGRAPH_ROOT: 0x120101,
			OLD_SCENEGRAPH_SORT_ORDER: 0x12010A,
			OLD_SCENEGRAPH_TRANSFORM: 0x120103,
			OLD_SCENEGRAPH_VISIBILITY: 0x120104,
			OLD_SPRITE_EMITTER: 0x15806,
			OLD_VECTOR_OFFSET_LIST: 0x121301,
			OLD_VECTOR2_OFFSET_LIST: 0x121302,
			OLD_VERTEX_ANIM_KEY_FRAME: 0x121304,
			PACKED_NORMAL_LIST: 0x10010,
			PARTICLE_SYSTEM_2: 0x15801,
			PARTICLE_SYSTEM_FACTORY: 0x15800,
			PATH: 0x300000B,
			PHYSICS_INERTIA_MATRIX: 0x7011001,
			PHYSICS_JOINT: 0x7011020,
			PHYSICS_OBJECT: 0x7011000,
			PHYSICS_VECTOR: 0x7011002,
			POSITION_LIST: 0x10005,
			QUATERNION_CHANNEL: 0x121105,
			RAIL_CAM: 0x300000A,
			RENDER_STATUS: 0x10017,
			ROAD: 0x3000003,
			ROAD_DATA_SEGMENT: 0x3000009,
			ROAD_SEGMENT: 0x3000002,
			SCENEGRAPH: 0x120100,
			SET: 0x3000110,
			SHADER: 0x11000,
			SHADER_COLOUR_PARAMETER: 0x11005,
			SHADER_FLOAT_PARAMETER: 0x11004,
			SHADER_INTEGER_PARAMETER: 0x11003,
			SHADER_TEXTURE_PARAMETER: 0x11002,
			SKELETON: 0x4500,
			SKELETON_JOINT: 0x4501,
			SKELETON_JOINT_BONE_PRESERVE: 0x4504,
			SKELETON_JOINT_MIRROR_MAP: 0x4503,
			SKIN: 0x10001,
			SPLINE: 0x3000007,
			SPRITE: 0x19005,
			STATE_PROP_CALLBACK_DATA: 0x8020005,
			STATE_PROP_DATA_V1: 0x8020000,
			STATE_PROP_EVENT_DATA: 0x8020004,
			STATE_PROP_FRAME_CONTROLLER_DATA: 0x8020003,
			STATE_PROP_STATE_DATA_V1: 0x8020001,
			STATE_PROP_VISIBILITIES_DATA: 0x8020002,
			STATIC_ENTITY: 0x3F00000,
			STATIC_PHYS: 0x3F00001,
			SURFACE_TYPE_LIST: 0x300000E,
			TEXTURE: 0x19000,
			TEXTURE_ANIMATION: 0x3520,
			TEXTURE_FONT: 0x22000,
			TEXTURE_GLYPH_LIST: 0x22001,
			TREE: 0x3F00004,
			TREE_NODE: 0x3F00005,
			TREE_NODE_2: 0x3F00006,
			TRIGGER_VOLUME: 0x3000006,
			UV_LIST: 0x10007,
			VECTOR_1D_OF_CHANNEL: 0x121102,
			VECTOR_2D_OF_CHANNEL: 0x121103,
			VECTOR_3D_OF_CHANNEL: 0x121104,
			VERTEX_SHADER: 0x10011,
			VOLUME_IMAGE: 0x19004,
			WALKER_CAMERA_DATA: 0x3000101,
			WEIGHT_LIST: 0x1000C,
			WORLD_SPHERE: 0x3F0000B,
		};

	static parseData(_options : ChunkParseDataOptions) : object
	{
		return {};
	}

	readonly identifier : number;

	children : Chunk[];

	constructor(options : ChunkOptions)
	{
		this.identifier = options.identifier;

		this.children = options.children ?? [];
	}

	getChildrenSize() : number
	{
		return this.children.reduce((size, child) => size + child.getEntireSize(), 0);
	}

	getDataSize() : number
	{
		const binaryWriter = new Pure3DBinaryWriter();

		this.writeData(binaryWriter);

		return binaryWriter.getBuffer().byteLength;
	}

	getEntireSize() : number
	{
		return 12 + this.getDataSize() + this.getChildrenSize();
	}

	write(binaryWriter : Pure3DBinaryWriter)
	{
		binaryWriter.writeUInt32(this.identifier);

		const dataSize = 12 + this.getDataSize();

		binaryWriter.writeUInt32(dataSize);

		const entireSize = this.getEntireSize();

		binaryWriter.writeUInt32(entireSize);

		this.writeData(binaryWriter);

		for (const child of this.children)
		{
			child.write(binaryWriter);
		}
	}

	writeData(_binaryWriter : Pure3DBinaryWriter) : void
	{

	}
}